[["working-with-relational-databases.html", "Chapter 6 Working with relational databases", " Chapter 6 Working with relational databases library(palmerpenguins) library(tidyverse) ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ── ## ✔ dplyr 1.1.4 ✔ readr 2.1.5 ## ✔ forcats 1.0.0 ✔ stringr 1.5.1 ## ✔ ggplot2 3.5.1 ✔ tibble 3.2.1 ## ✔ lubridate 1.9.3 ✔ tidyr 1.3.1 ## ✔ purrr 1.0.2 ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ── ## ✖ dplyr::filter() masks stats::filter() ## ✖ dplyr::lag() masks stats::lag() ## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors penguins %&gt;% tidyr::pivot_longer(contains(&quot;_&quot;), # measurement cols names_to = c(&quot;variable_name&quot;), values_to = &quot;value&quot;) ## # A tibble: 1,376 × 6 ## species island sex year variable_name value ## &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Adelie Torgersen male 2007 bill_length_mm 39.1 ## 2 Adelie Torgersen male 2007 bill_depth_mm 18.7 ## 3 Adelie Torgersen male 2007 flipper_length_mm 181 ## 4 Adelie Torgersen male 2007 body_mass_g 3750 ## 5 Adelie Torgersen female 2007 bill_length_mm 39.5 ## 6 Adelie Torgersen female 2007 bill_depth_mm 17.4 ## 7 Adelie Torgersen female 2007 flipper_length_mm 186 ## 8 Adelie Torgersen female 2007 body_mass_g 3800 ## 9 Adelie Torgersen female 2007 bill_length_mm 40.3 ## 10 Adelie Torgersen female 2007 bill_depth_mm 18 ## # ℹ 1,366 more rows penguins_long &lt;- penguins %&gt;% tidyr::pivot_longer(contains(&quot;_&quot;), # measurement cols names_to = c(&quot;part&quot;, &quot;measure&quot;, &quot;unit&quot;), names_sep = &quot;_&quot;) penguins_long ## # A tibble: 1,376 × 8 ## species island sex year part measure unit value ## &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Adelie Torgersen male 2007 bill length mm 39.1 ## 2 Adelie Torgersen male 2007 bill depth mm 18.7 ## 3 Adelie Torgersen male 2007 flipper length mm 181 ## 4 Adelie Torgersen male 2007 body mass g 3750 ## 5 Adelie Torgersen female 2007 bill length mm 39.5 ## 6 Adelie Torgersen female 2007 bill depth mm 17.4 ## 7 Adelie Torgersen female 2007 flipper length mm 186 ## 8 Adelie Torgersen female 2007 body mass g 3800 ## 9 Adelie Torgersen female 2007 bill length mm 40.3 ## 10 Adelie Torgersen female 2007 bill depth mm 18 ## # ℹ 1,366 more rows penguins_long %&gt;% tidyr::pivot_wider(names_from = c(&quot;part&quot;, &quot;measure&quot;, &quot;unit&quot;), # pivot these columns values_from = &quot;value&quot;, # take the values from here names_sep = &quot;_&quot;) # combine col names using an underscore ## Warning: Values from `value` are not uniquely identified; output will contain list-cols. ## • Use `values_fn = list` to suppress this warning. ## • Use `values_fn = {summary_fun}` to summarise duplicates. ## • Use the following dplyr code to identify duplicates. ## {data} |&gt; ## dplyr::summarise(n = dplyr::n(), .by = c(species, island, sex, year, part, ## measure, unit)) |&gt; ## dplyr::filter(n &gt; 1L) ## # A tibble: 35 × 8 ## species island sex year bill_length_mm bill_depth_mm flipper_length_mm ## &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; &lt;list&gt; &lt;list&gt; &lt;list&gt; ## 1 Adelie Torgersen male 2007 &lt;dbl [7]&gt; &lt;dbl [7]&gt; &lt;dbl [7]&gt; ## 2 Adelie Torgersen female 2007 &lt;dbl [8]&gt; &lt;dbl [8]&gt; &lt;dbl [8]&gt; ## 3 Adelie Torgersen &lt;NA&gt; 2007 &lt;dbl [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt; ## 4 Adelie Biscoe female 2007 &lt;dbl [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt; ## 5 Adelie Biscoe male 2007 &lt;dbl [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt; ## 6 Adelie Dream female 2007 &lt;dbl [9]&gt; &lt;dbl [9]&gt; &lt;dbl [9]&gt; ## 7 Adelie Dream male 2007 &lt;dbl [10]&gt; &lt;dbl [10]&gt; &lt;dbl [10]&gt; ## 8 Adelie Dream &lt;NA&gt; 2007 &lt;dbl [1]&gt; &lt;dbl [1]&gt; &lt;dbl [1]&gt; ## 9 Adelie Biscoe female 2008 &lt;dbl [9]&gt; &lt;dbl [9]&gt; &lt;dbl [9]&gt; ## 10 Adelie Biscoe male 2008 &lt;dbl [9]&gt; &lt;dbl [9]&gt; &lt;dbl [9]&gt; ## # ℹ 25 more rows ## # ℹ 1 more variable: body_mass_g &lt;list&gt; # give each measured penguin a number penguins_with_id &lt;- penguins %&gt;% mutate(id=seq(nrow(.))) # make the data long again penguins_long_ided &lt;- penguins_with_id %&gt;% tidyr::pivot_longer(contains(&quot;_&quot;), # measurement cols names_to = c(&quot;part&quot;, &quot;measure&quot;, &quot;unit&quot;), names_sep = &quot;_&quot;) # and wide again penguins_long_ided2 &lt;- penguins_long_ided %&gt;% tidyr::pivot_wider(names_from = c(&quot;part&quot;, &quot;measure&quot;, &quot;unit&quot;), values_from = &quot;value&quot;, names_sep = &quot;_&quot;) penguins %&gt;% head() ## # A tibble: 6 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 39.1 18.7 181 3750 ## 2 Adelie Torgersen 39.5 17.4 186 3800 ## 3 Adelie Torgersen 40.3 18 195 3250 ## 4 Adelie Torgersen NA NA NA NA ## 5 Adelie Torgersen 36.7 19.3 193 3450 ## 6 Adelie Torgersen 39.3 20.6 190 3650 ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% mutate(penguin_id = row_number(),.before = species) ## # A tibble: 344 × 9 ## penguin_id species island bill_length_mm bill_depth_mm flipper_length_mm ## &lt;int&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; ## 1 1 Adelie Torgersen 39.1 18.7 181 ## 2 2 Adelie Torgersen 39.5 17.4 186 ## 3 3 Adelie Torgersen 40.3 18 195 ## 4 4 Adelie Torgersen NA NA NA ## 5 5 Adelie Torgersen 36.7 19.3 193 ## 6 6 Adelie Torgersen 39.3 20.6 190 ## 7 7 Adelie Torgersen 38.9 17.8 181 ## 8 8 Adelie Torgersen 39.2 19.6 195 ## 9 9 Adelie Torgersen 34.1 18.1 193 ## 10 10 Adelie Torgersen 42 20.2 190 ## # ℹ 334 more rows ## # ℹ 3 more variables: body_mass_g &lt;int&gt;, sex &lt;fct&gt;, year &lt;int&gt; food_preference &lt;- tibble( penguin_species = c(&quot;Adelie&quot;, &quot;Chinstrap&quot;, &quot;Gentoo&quot;), favorite_food = c(&quot;peanut butter&quot;, &quot;cheese&quot;, &quot;chocolate&quot;) ) left_join( penguins, food_preference, by = c(&quot;species&quot; = &quot;penguin_species&quot;) ) ## # A tibble: 344 × 9 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 39.1 18.7 181 3750 ## 2 Adelie Torgersen 39.5 17.4 186 3800 ## 3 Adelie Torgersen 40.3 18 195 3250 ## 4 Adelie Torgersen NA NA NA NA ## 5 Adelie Torgersen 36.7 19.3 193 3450 ## 6 Adelie Torgersen 39.3 20.6 190 3650 ## 7 Adelie Torgersen 38.9 17.8 181 3625 ## 8 Adelie Torgersen 39.2 19.6 195 4675 ## 9 Adelie Torgersen 34.1 18.1 193 3475 ## 10 Adelie Torgersen 42 20.2 190 4250 ## # ℹ 334 more rows ## # ℹ 3 more variables: sex &lt;fct&gt;, year &lt;int&gt;, favorite_food &lt;chr&gt; penguins %&gt;% mutate(penguin_id = row_number(),.before = species) ## # A tibble: 344 × 9 ## penguin_id species island bill_length_mm bill_depth_mm flipper_length_mm ## &lt;int&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; ## 1 1 Adelie Torgersen 39.1 18.7 181 ## 2 2 Adelie Torgersen 39.5 17.4 186 ## 3 3 Adelie Torgersen 40.3 18 195 ## 4 4 Adelie Torgersen NA NA NA ## 5 5 Adelie Torgersen 36.7 19.3 193 ## 6 6 Adelie Torgersen 39.3 20.6 190 ## 7 7 Adelie Torgersen 38.9 17.8 181 ## 8 8 Adelie Torgersen 39.2 19.6 195 ## 9 9 Adelie Torgersen 34.1 18.1 193 ## 10 10 Adelie Torgersen 42 20.2 190 ## # ℹ 334 more rows ## # ℹ 3 more variables: body_mass_g &lt;int&gt;, sex &lt;fct&gt;, year &lt;int&gt; Let’s refresh your memory. Take the penguins dataset. As we all know, Adelie penguins love peanut butter, Chinstrap penguins prefer cheese and Gentoo penguins do anything for chocolate. Here is a table describing food preference: food_preference &lt;- tibble( penguin_species = c(&quot;Adelie&quot;, &quot;Chinstrap&quot;, &quot;Gentoo&quot;), favorite_food = c(&quot;peanut butter&quot;, &quot;cheese&quot;, &quot;chocolate&quot;) ) joined &lt;- left_join( penguins, food_preference, by = c(&quot;species&quot; = &quot;penguin_species&quot;) ) Now make a new tibble containing only the information on penguin species, sex and bill length measured in 2009 using filter and select. #penguins_long_ided #species island sex year id bill_length_mm bill_depth_mm ##filter(year==&quot;2009&quot;) # species island sex year id bill_length_mm bill_depth_mm head(penguins_long_ided2) ## # A tibble: 6 × 9 ## species island sex year id bill_length_mm bill_depth_mm ## &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Adelie Torgersen male 2007 1 39.1 18.7 ## 2 Adelie Torgersen female 2007 2 39.5 17.4 ## 3 Adelie Torgersen female 2007 3 40.3 18 ## 4 Adelie Torgersen &lt;NA&gt; 2007 4 NA NA ## 5 Adelie Torgersen female 2007 5 36.7 19.3 ## 6 Adelie Torgersen male 2007 6 39.3 20.6 ## # ℹ 2 more variables: flipper_length_mm &lt;dbl&gt;, body_mass_g &lt;dbl&gt; new_tbl &lt;- penguins_long_ided2 %&gt;% filter(year==2009) %&gt;% select(species,sex,bill_length_mm) head(new_tbl) ## # A tibble: 6 × 3 ## species sex bill_length_mm ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; ## 1 Adelie female 35 ## 2 Adelie male 41 ## 3 Adelie female 37.7 ## 4 Adelie male 37.8 ## 5 Adelie female 37.9 ## 6 Adelie male 39.7 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
